[{"id":"7a14643a.75260c","type":"subflow","name":"Splitter","info":"","category":"","in":[{"x":540,"y":300,"wires":[{"id":"273108cc.4b9928"}]}],"out":[{"x":1140,"y":300,"wires":[{"id":"a7524f72.576f3","port":0},{"id":"3d746554.ddcffa","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"273108cc.4b9928","type":"switch","z":"7a14643a.75260c","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"array","vt":"str"},{"t":"eq","v":"split","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":300,"wires":[["3d746554.ddcffa"],["fb18185d.5df9e8"]]},{"id":"a7524f72.576f3","type":"split","z":"7a14643a.75260c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":340,"wires":[[]]},{"id":"fb18185d.5df9e8","type":"change","z":"7a14643a.75260c","name":"del topic","rules":[{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":300,"wires":[["a7524f72.576f3"]]},{"id":"3d746554.ddcffa","type":"change","z":"7a14643a.75260c","name":"del topic","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"parts","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":240,"wires":[[]]},{"id":"d1abcd4.10bc03","type":"subflow","name":"Request Timer","info":"","category":"","in":[{"x":240,"y":180,"wires":[{"id":"f0a2d4f4.19a288"},{"id":"244e6655.741d9a"}]}],"out":[{"x":840,"y":180,"wires":[{"id":"244e6655.741d9a","port":0},{"id":"6bd8af1f.89fdd","port":0},{"id":"2a5d491d.97c806","port":0},{"id":"9e7f2747.5c4628","port":0},{"id":"c2dcb099.f3e78","port":0},{"id":"9fd56572.0c0b38","port":0},{"id":"f15b3597.8713b8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f0a2d4f4.19a288","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":220,"wires":[["6bd8af1f.89fdd","a0bdc284.5e792"]]},{"id":"a0bdc284.5e792","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":260,"wires":[["2a5d491d.97c806","ffdeebc6.4d7b88"]]},{"id":"244e6655.741d9a","type":"change","z":"d1abcd4.10bc03","name":"room","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"room","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":180,"wires":[[]]},{"id":"6bd8af1f.89fdd","type":"change","z":"d1abcd4.10bc03","name":"zone","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"zone","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":220,"wires":[[]]},{"id":"2a5d491d.97c806","type":"change","z":"d1abcd4.10bc03","name":"scene","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"scene","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":260,"wires":[[]]},{"id":"ffdeebc6.4d7b88","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":300,"wires":[["c2dcb099.f3e78","b2ade02a.ff9c1"]]},{"id":"c2dcb099.f3e78","type":"change","z":"d1abcd4.10bc03","name":"device","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"device","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":300,"wires":[[]]},{"id":"9e7f2747.5c4628","type":"change","z":"d1abcd4.10bc03","name":"motion","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":340,"wires":[[]]},{"id":"b2ade02a.ff9c1","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":340,"wires":[["9e7f2747.5c4628","db7b216c.0f12c"]]},{"id":"9fd56572.0c0b38","type":"change","z":"d1abcd4.10bc03","name":"button","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"button","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":380,"wires":[[]]},{"id":"f15b3597.8713b8","type":"change","z":"d1abcd4.10bc03","name":"light","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":420,"wires":[[]]},{"id":"db7b216c.0f12c","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":380,"wires":[["9fd56572.0c0b38","5ff7e2ec.4fce7c"]]},{"id":"5ff7e2ec.4fce7c","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":480,"y":420,"wires":[["f15b3597.8713b8"]]},{"id":"aff9cdb5.1ba04","type":"subflow","name":"Scenes Room / Zones","info":"","category":"","in":[{"x":660,"y":340,"wires":[{"id":"d783c4a0.a134f8"},{"id":"b2fff99f.0b7af8"}]}],"out":[{"x":1260,"y":300,"wires":[{"id":"fb43fcd6.f6b8c","port":0}]},{"x":1260,"y":380,"wires":[{"id":"c17682ee.48568","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"b2fff99f.0b7af8","type":"split","z":"aff9cdb5.1ba04","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":840,"y":380,"wires":[["48dc6c9.51e3694"]]},{"id":"48dc6c9.51e3694","type":"switch","z":"aff9cdb5.1ba04","name":"","property":"payload.zone-name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":380,"wires":[["c17682ee.48568"]]},{"id":"c17682ee.48568","type":"join","z":"aff9cdb5.1ba04","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"5","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1130,"y":380,"wires":[[]]},{"id":"a1aefb6a.38dee8","type":"switch","z":"aff9cdb5.1ba04","name":"","property":"payload.room-name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":300,"wires":[["fb43fcd6.f6b8c"]]},{"id":"fb43fcd6.f6b8c","type":"join","z":"aff9cdb5.1ba04","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"3","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1130,"y":300,"wires":[[]]},{"id":"d783c4a0.a134f8","type":"split","z":"aff9cdb5.1ba04","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":840,"y":300,"wires":[["a1aefb6a.38dee8"]]},{"id":"4c3d3acf.2f8024","type":"subflow","name":"HUE - Motion Sensor Event Filter","info":"","category":"","in":[{"x":380,"y":280,"wires":[{"id":"141a3bcf.ada954"}]}],"out":[{"x":960,"y":200,"wires":[{"id":"803a4d3.1397db","port":0}]},{"x":960,"y":280,"wires":[{"id":"803a4d3.1397db","port":0},{"id":"9d94cd03.7d235","port":0}]},{"x":960,"y":360,"wires":[{"id":"9d94cd03.7d235","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"141a3bcf.ada954","type":"switch","z":"4c3d3acf.2f8024","name":"payload.data.0.motion.motion","property":"payload.data.0.motion.motion","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":280,"wires":[["803a4d3.1397db"],["9d94cd03.7d235"]]},{"id":"803a4d3.1397db","type":"change","z":"4c3d3acf.2f8024","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":240,"wires":[[]]},{"id":"9d94cd03.7d235","type":"change","z":"4c3d3acf.2f8024","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":320,"wires":[[]]},{"id":"8e15a437.76f868","type":"comment","z":"4c3d3acf.2f8024","name":"PLEASE READ - DOUBLE CLICK","info":"Output 1:\nWill send just an **true** when Motion is detected\n\nOutput 2:\nWill send an **true** when Motion is detected and a **false** if no motion is detected any longer.\n\nOutput 3:\nWill send just an **false** when no Motion is detected any longer.\n\n\n-----------------------\nAll outputs are boolean\n-----------------------\n\nMost easy Subflow, but convinient when lots of sensors need to be set up.","x":580,"y":240,"wires":[]},{"id":"53cefa81.4b65a4","type":"comment","z":"4c3d3acf.2f8024","name":"motion true","info":"","x":1060,"y":200,"wires":[]},{"id":"223ce200.ad667e","type":"comment","z":"4c3d3acf.2f8024","name":"motion false","info":"","x":1070,"y":360,"wires":[]},{"id":"83e117e4.a287b8","type":"comment","z":"4c3d3acf.2f8024","name":"motion true / false","info":"","x":1090,"y":280,"wires":[]},{"id":"8b11354f.4a0658","type":"subflow","name":"HUE light / grouped_light Event Filter","info":"","category":"","in":[{"x":240,"y":320,"wires":[{"id":"dac5f0fa.1f40f"}]}],"out":[{"x":940,"y":240,"wires":[{"id":"aace2843.2871c8","port":0}]},{"x":940,"y":320,"wires":[{"id":"aace2843.2871c8","port":0},{"id":"41a47fec.70648","port":0}]},{"x":940,"y":400,"wires":[{"id":"41a47fec.70648","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"746939f9.f6b108","type":"rbe","z":"8b11354f.4a0658","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":670,"y":240,"wires":[["aace2843.2871c8"]]},{"id":"aace2843.2871c8","type":"switch","z":"8b11354f.4a0658","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":240,"wires":[[]]},{"id":"2f699b9.a0d8564","type":"change","z":"8b11354f.4a0658","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":200,"wires":[["564377fd.a0e0b8"]]},{"id":"564377fd.a0e0b8","type":"delay","z":"8b11354f.4a0658","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":200,"wires":[["746939f9.f6b108"]]},{"id":"fa001d5d.71b28","type":"change","z":"8b11354f.4a0658","name":"True","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":280,"wires":[["746939f9.f6b108"]]},{"id":"508f9bfa.48bee4","type":"delay","z":"8b11354f.4a0658","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":440,"wires":[["13d2358.64a41cb"]]},{"id":"13d2358.64a41cb","type":"rbe","z":"8b11354f.4a0658","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":670,"y":400,"wires":[["41a47fec.70648"]]},{"id":"53e1fe05.52fae","type":"change","z":"8b11354f.4a0658","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":360,"wires":[["13d2358.64a41cb"]]},{"id":"e79cdf6a.98b9a","type":"change","z":"8b11354f.4a0658","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":440,"wires":[["508f9bfa.48bee4"]]},{"id":"41a47fec.70648","type":"switch","z":"8b11354f.4a0658","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":790,"y":400,"wires":[[]]},{"id":"dac5f0fa.1f40f","type":"switch","z":"8b11354f.4a0658","name":"payload.data.0.on.on","property":"payload.data.0.on.on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":400,"y":320,"wires":[["fa001d5d.71b28","2f699b9.a0d8564"],["53e1fe05.52fae","e79cdf6a.98b9a"]]},{"id":"a6fe1e7b.98bbb","type":"comment","z":"8b11354f.4a0658","name":"On","info":"","x":1030,"y":240,"wires":[]},{"id":"df72e146.b2f1","type":"comment","z":"8b11354f.4a0658","name":"On / Off","info":"","x":1030,"y":320,"wires":[]},{"id":"866ec200.3d95a","type":"comment","z":"8b11354f.4a0658","name":"Off","info":"","x":1030,"y":400,"wires":[]},{"id":"75146258.9bc82c","type":"comment","z":"8b11354f.4a0658","name":"PLEASE READ - DOUBLE CLICK","info":"Output 1:\nThis output will send a **true** when Lights or Groups are turned on.\n\nOutput 2:\nThis output will send a **true** when Lights or Groups are turned on AND a **false** when Lights or Groups are turned off.\n\nOutput 3:\nThis output will send a **false** when Lights or Groups are turned off\n\n\n\nDepending on your Situation it can be useful just to have a **true** OR **false** OR **both** states in your Flow. Thats the reason i built this Subflow.\nJust use the Output that makes you happy :)\n\n\n-----------------------\nAll outputs are boolean \n-----------------------\n\n\nThe delays will reset the RBE nodes.\nYou can adjust the times for your needs, but this worked for me prefectly.","x":360,"y":280,"wires":[]},{"id":"a0f46ca3.05bb","type":"subflow","name":"HUE Button Event Filter","info":"","category":"","in":[{"x":220,"y":440,"wires":[{"id":"16fe52.092431af"}]}],"out":[{"x":1060,"y":180,"wires":[{"id":"b32878f3.1affd8","port":0}]},{"x":1060,"y":380,"wires":[{"id":"3b896174.68dd9e","port":0}]},{"x":1060,"y":540,"wires":[{"id":"4e317780.000048","port":0}]},{"x":1060,"y":700,"wires":[{"id":"5785d67f.aaa618","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"5c9c6f16.5554d","type":"rbe","z":"a0f46ca3.05bb","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":810,"y":180,"wires":[["b32878f3.1affd8"]]},{"id":"b32878f3.1affd8","type":"switch","z":"a0f46ca3.05bb","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":180,"wires":[[]]},{"id":"1e0b07e4.60c4d8","type":"change","z":"a0f46ca3.05bb","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":140,"wires":[["b42db4d.b8a2b48"]]},{"id":"b42db4d.b8a2b48","type":"delay","z":"a0f46ca3.05bb","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":930,"y":140,"wires":[["5c9c6f16.5554d"]]},{"id":"95a9a39.1d3dc6","type":"change","z":"a0f46ca3.05bb","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":220,"wires":[["5c9c6f16.5554d"]]},{"id":"b3cdb363.f8188","type":"delay","z":"a0f46ca3.05bb","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":930,"y":660,"wires":[["9e027249.8c0a7"]]},{"id":"9e027249.8c0a7","type":"rbe","z":"a0f46ca3.05bb","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":810,"y":700,"wires":[["5785d67f.aaa618"]]},{"id":"17135676.a1efda","type":"change","z":"a0f46ca3.05bb","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":660,"wires":[["b3cdb363.f8188"]]},{"id":"7f17a1ec.8e6b1","type":"change","z":"a0f46ca3.05bb","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":740,"wires":[["9e027249.8c0a7"]]},{"id":"5785d67f.aaa618","type":"switch","z":"a0f46ca3.05bb","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":700,"wires":[[]]},{"id":"16fe52.092431af","type":"switch","z":"a0f46ca3.05bb","name":"payload.data.0.button.last_event","property":"payload.data.0.button.last_event","propertyType":"msg","rules":[{"t":"cont","v":"initial_press","vt":"str"},{"t":"cont","v":"short_release","vt":"str"},{"t":"cont","v":"repeat","vt":"str"},{"t":"cont","v":"long_release","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":430,"y":440,"wires":[["1e0b07e4.60c4d8","95a9a39.1d3dc6"],["46f6f60.375360c","c2c46cf6.3eb51"],["4e317780.000048"],["7f17a1ec.8e6b1","17135676.a1efda"]]},{"id":"824dedac.3b8ea","type":"rbe","z":"a0f46ca3.05bb","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":810,"y":380,"wires":[["3b896174.68dd9e"]]},{"id":"3b896174.68dd9e","type":"switch","z":"a0f46ca3.05bb","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":930,"y":380,"wires":[[]]},{"id":"c2c46cf6.3eb51","type":"change","z":"a0f46ca3.05bb","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":340,"wires":[["6936b721.8e55a8"]]},{"id":"6936b721.8e55a8","type":"delay","z":"a0f46ca3.05bb","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":930,"y":340,"wires":[["824dedac.3b8ea"]]},{"id":"46f6f60.375360c","type":"change","z":"a0f46ca3.05bb","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":420,"wires":[["824dedac.3b8ea"]]},{"id":"196bd0e9.4b109f","type":"comment","z":"a0f46ca3.05bb","name":"initial_press","info":"","x":830,"y":100,"wires":[]},{"id":"49d7d8aa.5cfb58","type":"comment","z":"a0f46ca3.05bb","name":"short_release","info":"","x":830,"y":300,"wires":[]},{"id":"b841cfd2.439de","type":"comment","z":"a0f46ca3.05bb","name":"long_release","info":"","x":830,"y":620,"wires":[]},{"id":"4e317780.000048","type":"change","z":"a0f46ca3.05bb","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":540,"wires":[[]]},{"id":"77123b03.4edec4","type":"comment","z":"a0f46ca3.05bb","name":"repeat","info":"","x":810,"y":500,"wires":[]},{"id":"ffcecb8d.db6828","type":"comment","z":"a0f46ca3.05bb","name":"PLEASE READ - DOUBLE CLICK","info":"Output 1:\nThe **initial_press** comes ALWAYS directly after you push the Button. Quickest response possible!\n\nOutput 2:\nThe **short_release** will just appear after the **initial_press**, when you pushed the Button quick.\n\nOutput 3:\nThe **repeat** will appear if you hold the button, and will send a message every second until you release it.\n\nOutput 4:\nThe **long_release** will appear after the **repeat** ENDED!\n\n\n--------------------------------\nAll outputs are boolean **true**\n--------------------------------\n\n\nThe delays will reset the RBE node with a false.\nYou can adjust the times for your needs, but this worked for me prefectly.","x":440,"y":380,"wires":[]},{"id":"56a9ddfc.0001f4","type":"tab","label":"HUE API V2 CONTROL","disabled":false,"info":""},{"id":"84e4e2f1.1a016","type":"subflow:a0f46ca3.05bb","z":"56a9ddfc.0001f4","name":"","env":[],"x":2510,"y":400,"wires":[["ac875e16.63482"],["363c7a56.5b9536"],["4d466db0.acc304"],["3c135e8f.96d652"]]},{"id":"cebbe3c7.368e6","type":"subflow:8b11354f.4a0658","z":"56a9ddfc.0001f4","name":"","env":[],"x":2470,"y":740,"wires":[["325a9966.f50a76"],["2739ae8c.8a6c82"],["24dffc64.54a264"]]},{"id":"16c9c4ba.16f75b","type":"subflow:4c3d3acf.2f8024","z":"56a9ddfc.0001f4","name":"","x":2480,"y":580,"wires":[["fd837119.af71c"],["44c4770b.63ac58"],["d1f2bed1.99d62"]]},{"id":"bfcb26cf.b30fe8","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":700,"wires":[]},{"id":"38faa924.b74546","type":"inject","z":"56a9ddfc.0001f4","name":"Get all lights","props":[{"p":"endpoint","v":"light","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":310,"y":420,"wires":[["aed035b1.67d568"]]},{"id":"580835bf.1beb4c","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":580,"wires":[]},{"id":"71ef0d0.d1997f4","type":"inject","z":"56a9ddfc.0001f4","name":"Get all scenes","props":[{"p":"endpoint","v":"scene","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":310,"y":380,"wires":[["aed035b1.67d568"]]},{"id":"b1c5afdd.f4c49","type":"inject","z":"56a9ddfc.0001f4","name":"Get all rooms","props":[{"p":"endpoint","v":"room","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":310,"y":460,"wires":[["aed035b1.67d568"]]},{"id":"9eb1fc51.373e","type":"inject","z":"56a9ddfc.0001f4","name":"Get all zones","props":[{"p":"endpoint","v":"zone","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":310,"y":500,"wires":[["aed035b1.67d568"]]},{"id":"6f55c280.d3b75c","type":"inject","z":"56a9ddfc.0001f4","name":"Get All","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":330,"y":260,"wires":[["aed035b1.67d568"]]},{"id":"a0b14ea3.095fe","type":"comment","z":"56a9ddfc.0001f4","name":"Bridge Data","info":"","x":270,"y":220,"wires":[]},{"id":"ca3a320b.f379b","type":"comment","z":"56a9ddfc.0001f4","name":"HUE Clip API V2","info":"","x":1180,"y":580,"wires":[]},{"id":"d6f5a979.26cb98","type":"http request","z":"56a9ddfc.0001f4","name":"https request HUE API V2","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"4bc31af9bd03bbdc","persist":false,"proxy":"","authType":"","x":930,"y":580,"wires":[["580835bf.1beb4c","13a96f9.261ac9"]]},{"id":"97cc1116.6f3c5","type":"inject","z":"56a9ddfc.0001f4","name":"Motion","props":[{"p":"endpoint","v":"motion","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":330,"y":340,"wires":[["aed035b1.67d568"]]},{"id":"8bf78b96.102ef8","type":"inject","z":"56a9ddfc.0001f4","name":"Button","props":[{"p":"endpoint","v":"button ","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":330,"y":300,"wires":[["aed035b1.67d568"]]},{"id":"d412dd90.7e7f7","type":"inject","z":"56a9ddfc.0001f4","name":"Bridge Home","props":[{"p":"endpoint","v":"bridge_home","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":310,"y":540,"wires":[["aed035b1.67d568"]]},{"id":"1e548884.458df7","type":"inject","z":"56a9ddfc.0001f4","name":"Device Power","props":[{"p":"endpoint","v":"device_power","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":300,"y":580,"wires":[["aed035b1.67d568"]]},{"id":"98d294a5.907688","type":"philipshue-events","z":"56a9ddfc.0001f4","d":true,"bridge":"","x":300,"y":700,"wires":[["bfcb26cf.b30fe8","ee89c8d0.30a558"]]},{"id":"ee89c8d0.30a558","type":"link out","z":"56a9ddfc.0001f4","name":"BRIDGE EVENTSTREAM OUT","links":["b073c2ca.c11b7","fc836ab4.4adae8","a5f7c87b.cd5608"],"x":435,"y":700,"wires":[]},{"id":"aed035b1.67d568","type":"function","z":"56a9ddfc.0001f4","name":"HUE API V2","func":"\n// you can copy the user key from the hue config node out of Huemagic\nvar user = \"Replace with your Secret Key here\";\n\n\nif(msg.endpoint === undefined)\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource\";\nelse if(msg.topic === undefined)\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource/\" + msg.endpoint;\nelse\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource/\" + msg.endpoint + \"/\" + msg.topic;\n\n\nmsg.headers = {};\n\nmsg.headers['hue-application-key'] = user;\nmsg.headers['Content-Type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json';\n\nif(msg.payload != undefined)\n msg.headers['ContentLength'] = JSON.stringify(msg.payload).length;\n\nif(msg.verb === undefined)\n msg.method = \"get\";\nelse\n msg.method = msg.verb;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":580,"wires":[["d6f5a979.26cb98"]]},{"id":"c2b84706.007c78","type":"comment","z":"56a9ddfc.0001f4","name":"Event Stream from the Bridge","info":"","x":1140,"y":700,"wires":[]},{"id":"17f328f8.1ee557","type":"switch","z":"56a9ddfc.0001f4","name":"Button Event Stream","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"replace with discovered ID of your Button","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2060,"y":400,"wires":[["84e4e2f1.1a016"]]},{"id":"b073c2ca.c11b7","type":"link in","z":"56a9ddfc.0001f4","name":"Events  IN","links":["ee89c8d0.30a558"],"x":1795,"y":580,"wires":[["17f328f8.1ee557","50bbd58b.c9f21c","7d7a08.35d4a5f8"]]},{"id":"ac875e16.63482","type":"debug","z":"56a9ddfc.0001f4","name":"initial","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":340,"wires":[]},{"id":"363c7a56.5b9536","type":"debug","z":"56a9ddfc.0001f4","name":"short","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":380,"wires":[]},{"id":"4d466db0.acc304","type":"debug","z":"56a9ddfc.0001f4","name":"holded","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":420,"wires":[]},{"id":"3c135e8f.96d652","type":"debug","z":"56a9ddfc.0001f4","name":"long","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":460,"wires":[]},{"id":"fd837119.af71c","type":"debug","z":"56a9ddfc.0001f4","name":"motion true","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2830,"y":540,"wires":[]},{"id":"44c4770b.63ac58","type":"debug","z":"56a9ddfc.0001f4","name":"motion true + false","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2850,"y":580,"wires":[]},{"id":"d1f2bed1.99d62","type":"debug","z":"56a9ddfc.0001f4","name":"motion false","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2830,"y":620,"wires":[]},{"id":"50bbd58b.c9f21c","type":"switch","z":"56a9ddfc.0001f4","name":"Motion Event Stream","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"replace with discovered ID of your Sensor","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2060,"y":580,"wires":[["16c9c4ba.16f75b"]]},{"id":"325a9966.f50a76","type":"debug","z":"56a9ddfc.0001f4","name":"On","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":700,"wires":[]},{"id":"2739ae8c.8a6c82","type":"debug","z":"56a9ddfc.0001f4","name":"On / Off","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2820,"y":740,"wires":[]},{"id":"24dffc64.54a264","type":"debug","z":"56a9ddfc.0001f4","name":"Off","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2810,"y":780,"wires":[]},{"id":"7d7a08.35d4a5f8","type":"switch","z":"56a9ddfc.0001f4","name":"light / grouped_light Event Stream","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"replace with discovered RID of Lamp / Group","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2100,"y":740,"wires":[["cebbe3c7.368e6"]]},{"id":"2ca1de10.d9f262","type":"comment","z":"56a9ddfc.0001f4","name":"This Filters the events for your Devices, you need to add the discovered IDs in the switch nodes","info":"","x":2290,"y":320,"wires":[]},{"id":"24b33611.ba558a","type":"comment","z":"56a9ddfc.0001f4","name":"Dont touch this Node","info":"","x":940,"y":540,"wires":[]},{"id":"5af5c4a6.735b7c","type":"comment","z":"56a9ddfc.0001f4","name":"Add your Data here","info":"","x":290,"y":660,"wires":[]},{"id":"8ecbb9e1.8c1d08","type":"comment","z":"56a9ddfc.0001f4","name":"ATTENTION! READ FIRST - DOUBLE CLICK","info":"First you need to add your Data, IP Adress, Secret Key into the Nodes that have an **add Data** Label, then deploy.\n\nALL CHANGE NODES NEED TO BE EDITED WITH \nDISCOVERED ID / RID, do this step by step","x":990,"y":260,"wires":[]},{"id":"99eaa29c.0f812","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1090,"y":220,"wires":[]},{"id":"1198f60e.62348a","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1090,"y":300,"wires":[]},{"id":"5a9db7a6.84b058","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":220,"wires":[]},{"id":"5f96dc29.c7d944","type":"debug","z":"56a9ddfc.0001f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":300,"wires":[]},{"id":"1017ea2b.28ee76","type":"comment","z":"56a9ddfc.0001f4","name":"Check inside the Subflows for additional Information","info":"","x":2430,"y":480,"wires":[]},{"id":"6c01a647.956d58","type":"change","z":"56a9ddfc.0001f4","name":"Dimming 10% down / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"dynamics\":{\"duration\":1000},\"dimming_delta\":{\"action\":\"down\",\"brightness_delta\":10}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":1040,"wires":[["64bf48b5.64eda8"]]},{"id":"dcc02d41.cffe4","type":"change","z":"56a9ddfc.0001f4","name":"Light off / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":false},\"dynamics\":{\"duration\":1000}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":1120,"wires":[["64bf48b5.64eda8"]]},{"id":"517df025.760f6","type":"http request","z":"56a9ddfc.0001f4","name":"https request HUE API V2","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"4bc31af9bd03bbdc","persist":false,"proxy":"","authType":"","x":1290,"y":1360,"wires":[["b49f06e.111bdf8"]]},{"id":"9f7c602e.9a74b","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1040,"wires":[["6c01a647.956d58"]]},{"id":"f210ce78.3061d","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1000,"wires":[["e0476b05.c78068"]]},{"id":"908477fc.4159c8","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1120,"wires":[["dcc02d41.cffe4"]]},{"id":"e0476b05.c78068","type":"change","z":"56a9ddfc.0001f4","name":"Light on / 100% / orange / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"dynamics\":{\"duration\":1000},\"color\":{\"xy\":{\"x\":0.6101,\"y\":0.3662}}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":1000,"wires":[["64bf48b5.64eda8"]]},{"id":"a482cf6.0bc873","type":"change","z":"56a9ddfc.0001f4","name":"Dimming 10% up / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"dynamics\":{\"duration\":1000},\"dimming_delta\":{\"action\":\"up\",\"brightness_delta\":10}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":1080,"wires":[["64bf48b5.64eda8"]]},{"id":"35bea1c0.2d67ee","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1080,"wires":[["a482cf6.0bc873"]]},{"id":"7c4c7287.f973fc","type":"change","z":"56a9ddfc.0001f4","name":"Light on / 100% / red / alert flashing","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"color\":{\"xy\":{\"x\":0.7,\"y\":0.25}},\"alert\":{\"action\":\"breathe\"}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":1160,"wires":[["64bf48b5.64eda8"]]},{"id":"f987fd60.f08d7","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1160,"wires":[["7c4c7287.f973fc"]]},{"id":"c069714.8eadb9","type":"change","z":"56a9ddfc.0001f4","name":"Light on / 80% / 2s transition / color temp cold 153","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":80},\"dynamics\":{\"duration\":2000},\"color_temperature\":{\"mirek\":153}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1200,"wires":[["64bf48b5.64eda8"]]},{"id":"8b64befe.3ff7d","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1200,"wires":[["c069714.8eadb9"]]},{"id":"d08716af.fa7288","type":"change","z":"56a9ddfc.0001f4","name":"Light on / 50% / 1s transition / color temp warm 500","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":50},\"dynamics\":{\"duration\":1000},\"color_temperature\":{\"mirek\":500}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1240,"wires":[["64bf48b5.64eda8"]]},{"id":"49199026.ab11d","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1240,"wires":[["d08716af.fa7288"]]},{"id":"e3cc04f4.c1d138","type":"comment","z":"56a9ddfc.0001f4","name":"lights - DOUBLE CLICK FOR INFO","info":"","x":360,"y":960,"wires":[]},{"id":"c4a73add.214f78","type":"change","z":"56a9ddfc.0001f4","name":"Room or Zone on / 100% / orange / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"replace with discovered !!!>> RID <<!!!","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"dynamics\":{\"duration\":1000},\"color\":{\"xy\":{\"x\":0.6101,\"y\":0.3662}}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1360,"wires":[["64bf48b5.64eda8"]]},{"id":"3d3b5435.63b7dc","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1360,"wires":[["c4a73add.214f78"]]},{"id":"edf3f028.f1d01","type":"comment","z":"56a9ddfc.0001f4","name":"grouped_light - DOUBLE CLICK FOR INFO","info":"(Rooms & Zones) can be controlled in almost the samme way as lights. \n\nJust the endpoint in the change node is different and instead of using the ID of a Room / Zone you need to use the discoverd **rid **\n\ngrouped_light is a service (rid) that is connected to the group/zone ID","x":390,"y":1320,"wires":[]},{"id":"538bf907.32de88","type":"change","z":"56a9ddfc.0001f4","name":"Motion Sensor DISABLED","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"enabled\":false}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":1680,"wires":[["64bf48b5.64eda8"]]},{"id":"5d4d3fc7.0d864","type":"change","z":"56a9ddfc.0001f4","name":"Motion Sensor ENABLED","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"enabled\":true}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":1640,"wires":[["64bf48b5.64eda8"]]},{"id":"f1a6d7fe.ce85b8","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1680,"wires":[["538bf907.32de88"]]},{"id":"d750744.2ffd588","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1640,"wires":[["5d4d3fc7.0d864"]]},{"id":"b1aa549b.424a38","type":"link in","z":"56a9ddfc.0001f4","name":"Motion Sensor ***Name*** On","links":[],"x":435,"y":1640,"wires":[["5d4d3fc7.0d864"]]},{"id":"c3e862fe.aaf66","type":"link in","z":"56a9ddfc.0001f4","name":"Motion Sensor ***Name*** Off","links":[],"x":435,"y":1680,"wires":[["538bf907.32de88"]]},{"id":"dfe1cb5b.67a688","type":"comment","z":"56a9ddfc.0001f4","name":"Motion Sensor ENABLED / DISABLED","info":"","x":370,"y":1600,"wires":[]},{"id":"7d4d038.b31a6fc","type":"change","z":"56a9ddfc.0001f4","name":"Recall a Scene","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"scene","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"recall\":{\"action\":\"active\"}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1520,"wires":[["64bf48b5.64eda8"]],"icon":"font-awesome/fa-star"},{"id":"51258312.d0c33c","type":"change","z":"56a9ddfc.0001f4","name":"Room or Zone off","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"replace with discovered !!!>> RID <<!!!","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":false}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":1400,"wires":[["64bf48b5.64eda8"]]},{"id":"8cb919b5.040ad8","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1400,"wires":[["51258312.d0c33c"]]},{"id":"d3b8101c.76109","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1520,"wires":[["7d4d038.b31a6fc"]]},{"id":"113ea69d.6dc259","type":"comment","z":"56a9ddfc.0001f4","name":"Add your Data here","info":"","x":1070,"y":1320,"wires":[]},{"id":"c123d607.88dfa8","type":"comment","z":"56a9ddfc.0001f4","name":"Add your Data here","info":"","x":670,"y":540,"wires":[]},{"id":"fce40a59.f541e8","type":"comment","z":"56a9ddfc.0001f4","name":"Recall a Scene - DOUBLE CLICK FOR INFO","info":"I highly recommend to use Scenes to turn on Rooms/Zones. This is just one request to the Bridge and the rest is processed in the bridge. When 4 lights are turned on simultanious, the bridge possible wont be able to handle these requests at once.\n\nIf you have a sestup where it is needed to turn on seperate lights, then add delay nodes i front of the chhange node. \n\nExample: 4 Lights need to be tunes on, \nlight 1 = no delay\nlight 2 = 200ms delay\nlight 3 = 400ms delay\nlight 4 = 600ms delay\n\nwhen turning light off simultanious, this should be done in this way. Better is to turn off Rooms or Zones with one request.","x":390,"y":1480,"wires":[]},{"id":"b49f06e.111bdf8","type":"debug","z":"56a9ddfc.0001f4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":1360,"wires":[]},{"id":"172467c1.fca7d8","type":"comment","z":"56a9ddfc.0001f4","name":"Dont touch this Node","info":"","x":1300,"y":1320,"wires":[]},{"id":"29ffe66b.fafffa","type":"comment","z":"56a9ddfc.0001f4","name":"You need one swich and subflow for every button / light / sensor / grouped_light where you want to have a response from","info":"","x":2360,"y":840,"wires":[]},{"id":"64bf48b5.64eda8","type":"function","z":"56a9ddfc.0001f4","name":"HUE API V2","func":"\n// you can copy the user key from the hue config node out of Huemagic\nvar user = \"Replace with your Secret Key here\";\n\n\nif(msg.endpoint === undefined)\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource\";\nelse if(msg.topic === undefined)\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource/\" + msg.endpoint;\nelse\n msg.url = \"https://BRIDGE IP HERE/clip/v2/resource/\" + msg.endpoint + \"/\" + msg.topic;\n\n\nmsg.headers = {};\n\nmsg.headers['hue-application-key'] = user;\nmsg.headers['Content-Type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json';\n\nif(msg.payload != undefined)\n msg.headers['ContentLength'] = JSON.stringify(msg.payload).length;\n\nif(msg.verb === undefined)\n msg.method = \"get\";\nelse\n msg.method = msg.verb;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1360,"wires":[["517df025.760f6"]]},{"id":"edc180cc.926a8","type":"function","z":"56a9ddfc.0001f4","name":"HEADER V2","func":"// you can copy the user key from the hue config node out of Huemagic\nvar user = \"YOUR CODE\";\nvar ip = \"YOUR IP\"\n\nif(msg.endpoint === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource\";\nelse if(msg.topic === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint;\nelse\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint + \"/\" + msg.topic;\n\nmsg.headers = {};\n\nmsg.headers['hue-application-key'] = user;\nmsg.headers['Content-Type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json';\n\nif(msg.payload != undefined)\n msg.headers['ContentLength'] = JSON.stringify(msg.payload).length;\n\nif(msg.verb === undefined)\n msg.method = \"get\";\nelse\n msg.method = msg.verb;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1470,"y":260,"wires":[[]]},{"id":"b74f58013a96f441","type":"change","z":"56a9ddfc.0001f4","name":"Get State","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"ADD GROUP RID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"get","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1800,"wires":[["64bf48b5.64eda8"]]},{"id":"b9905ba4.2335e8","type":"comment","z":"56a9ddfc.0001f4","name":"\"Helper Functions for RID / ID discovery\" (credits to user marc-gist for his help!)","info":"","x":2400,"y":1240,"wires":[]},{"id":"13a96f9.261ac9","type":"link out","z":"56a9ddfc.0001f4","name":"API Response OUT","links":["473a4cdc.593674"],"x":1335,"y":580,"wires":[]},{"id":"4433b152.6029d","type":"comment","z":"56a9ddfc.0001f4","name":"This helps you to discover the ID / RID for Scenes / lights / grouped_light","info":"","x":2400,"y":1280,"wires":[]},{"id":"31340eef.b41302","type":"inject","z":"56a9ddfc.0001f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":1800,"wires":[["b74f58013a96f441"]]},{"id":"b67ced85.f24e3","type":"comment","z":"56a9ddfc.0001f4","name":"Get state of a Group","info":"","x":310,"y":1760,"wires":[]},{"id":"b83322c3.361a1","type":"comment","z":"56a9ddfc.0001f4","name":"Header Node V2 - DOUBLE CLICK FOR INFO","info":"Version 2 of the Header Node, easier setup.\nYou can decide by yourself which one you like to use. If your Flow is already running, no need to change.","x":1470,"y":220,"wires":[]},{"id":"473a4cdc.593674","type":"link in","z":"56a9ddfc.0001f4","name":"BRIDGE DATA RESPONSE IN","links":["9843e319.dcf13","13a96f9.261ac9"],"x":2555,"y":1600,"wires":[["a8fe8327.b5826","b260caba.8ee0e8","f50205ef.511b38","c99f72b.86fac9","ab0eaa70.e72fb8","6515ee56.e8bbb","77339fcc.c76a8"]]},{"id":"a8fe8327.b5826","type":"switch","z":"56a9ddfc.0001f4","name":"Room","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"room","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":1380,"wires":[["5281ce31.81651","18ca2231.e3138e"]]},{"id":"5f81dd61.2b48c4","type":"inject","z":"56a9ddfc.0001f4","name":"Scenes Zone (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"zone_scenes","payloadType":"flow","x":1930,"y":1740,"wires":[["1adff996.f43ed6"]]},{"id":"b0c1c08f.cd09","type":"change","z":"56a9ddfc.0001f4","name":"rooms","rules":[{"t":"set","p":"rooms","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":1320,"wires":[[]]},{"id":"b260caba.8ee0e8","type":"switch","z":"56a9ddfc.0001f4","name":"Scene","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"scene","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":1600,"wires":[["a92d8993.234808","9d108223.484bb"]]},{"id":"f50205ef.511b38","type":"switch","z":"56a9ddfc.0001f4","name":"Light","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"light","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":2120,"wires":[["c184b3ad.f0547"]]},{"id":"c99f72b.86fac9","type":"switch","z":"56a9ddfc.0001f4","name":"Zone","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"zone","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":1180,"wires":[["9da74eb5.c82d4","11c52499.8a819b"]]},{"id":"a92d8993.234808","type":"function","z":"56a9ddfc.0001f4","name":"Scene Name, ID, Zone Name","func":"var response = [];\nvar zones = flow.get(\"zones\") || {};\nvar size = Object.keys(zones).length;\nif(size <= 0) {\n    node.error(\"Please Update Zones First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"id\": item.id,\n        // \"rid\": item.group.rid,\n        // \"rtype\": item.group.rtype,\n        \"zone-name\": zones[item.group.rid]\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Scene name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3070,"y":1560,"wires":[["745bd723.b4cb48"]]},{"id":"4ce2bfd3.60447","type":"change","z":"56a9ddfc.0001f4","name":"zones","rules":[{"t":"set","p":"zones","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":1120,"wires":[[]]},{"id":"745bd723.b4cb48","type":"subflow:aff9cdb5.1ba04","z":"56a9ddfc.0001f4","name":"","env":[],"x":3100,"y":1600,"wires":[["1134a254.0a791e","c7a424f1.138818"],["6048660a.edfb28","93fb11ca.c149b"]]},{"id":"1134a254.0a791e","type":"debug","z":"56a9ddfc.0001f4","name":"Room Scenes","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3420,"y":1560,"wires":[]},{"id":"6048660a.edfb28","type":"debug","z":"56a9ddfc.0001f4","name":"Zone Scenes","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3410,"y":1640,"wires":[]},{"id":"1c2578db.96e2c7","type":"debug","z":"56a9ddfc.0001f4","name":"Rooms","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3400,"y":1360,"wires":[]},{"id":"5bf4d24f.d7f07c","type":"debug","z":"56a9ddfc.0001f4","name":"Zones","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3390,"y":1160,"wires":[]},{"id":"e43d3f47.f52f1","type":"inject","z":"56a9ddfc.0001f4","name":"Get all Data","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1970,"y":1080,"wires":[["adfc47.693e13b8"]]},{"id":"c7a424f1.138818","type":"change","z":"56a9ddfc.0001f4","name":"room_scenes","rules":[{"t":"set","p":"room_scenes","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3120,"y":1520,"wires":[[]]},{"id":"adfc47.693e13b8","type":"subflow:d1abcd4.10bc03","z":"56a9ddfc.0001f4","name":"Request","env":[],"x":2280,"y":1080,"wires":[["c639e802.9a6c78"]]},{"id":"c639e802.9a6c78","type":"link out","z":"56a9ddfc.0001f4","name":"Timer Out","links":["6e3a4608.2e8928","c0ea44d8.8272a8"],"x":2455,"y":1080,"wires":[]},{"id":"b0e860ed.47474","type":"comment","z":"56a9ddfc.0001f4","name":"1 - Readme - DOUBLE CLICK","info":"This Flow is for discovering the needed IDs / RIDs. This makes it easier instead of searching in the payload of the https response from the Bridge!\n\n**Thanks to fellow Github User @marc-gist who had this great idea and programmed the function nodes!**\n\n\"Get all Data\" discovers Datapoints from:\n\n- Rooms / Zones\n- Scenes\n- Devices\n- Motion Sensors\n- Buttons\n- Lights\n\nThe process takes about 15 seconds, depending on your setup. You directly see arrays in the debug window, but the context is also stored in a variable. \n\n>>> No need to change anything in this Flow <<<\n\n- By clicking \"Get all Data\" Inject Node, you also refresh the stored Data. \n\n- The \"Delete\" Inject Node is for deleting the storead Data if needed at some point.\n\n","x":2020,"y":1040,"wires":[]},{"id":"93fb11ca.c149b","type":"change","z":"56a9ddfc.0001f4","name":"zone scene","rules":[{"t":"set","p":"zone_scenes","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3130,"y":1680,"wires":[[]]},{"id":"df8fd5f9.59db08","type":"inject","z":"56a9ddfc.0001f4","name":"Scenes Zone (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"zone_scenes","payloadType":"flow","x":1940,"y":1700,"wires":[["1adff996.f43ed6"]]},{"id":"5a3ac02d.42096","type":"inject","z":"56a9ddfc.0001f4","name":"Scenes Room (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"room_scenes","payloadType":"flow","x":1930,"y":1440,"wires":[["1adff996.f43ed6"]]},{"id":"8be2de1d.232f2","type":"inject","z":"56a9ddfc.0001f4","name":"Scenes Room (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"room_scenes","payloadType":"flow","x":1930,"y":1480,"wires":[["1adff996.f43ed6"]]},{"id":"1adff996.f43ed6","type":"subflow:7a14643a.75260c","z":"56a9ddfc.0001f4","name":"","env":[],"x":2300,"y":1600,"wires":[["3e0417af.770258"]]},{"id":"e3ea92e5.cc115","type":"change","z":"56a9ddfc.0001f4","name":"DELETE STORED CONTEXT","rules":[{"t":"delete","p":"zones","pt":"flow"},{"t":"delete","p":"rooms","pt":"flow"},{"t":"delete","p":"lights","pt":"flow"},{"t":"delete","p":"zone_scenes","pt":"flow"},{"t":"delete","p":"room_scenes","pt":"flow"},{"t":"delete","p":"rooms_array","pt":"flow"},{"t":"delete","p":"zones_array","pt":"flow"},{"t":"delete","p":"devices","pt":"flow"},{"t":"delete","p":"motion","pt":"flow"},{"t":"delete","p":"lights","pt":"flow"},{"t":"delete","p":"button","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":1000,"wires":[[]]},{"id":"4a4a0367.b3df5c","type":"inject","z":"56a9ddfc.0001f4","name":"Delete","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1990,"y":1000,"wires":[["e3ea92e5.cc115"]]},{"id":"ab31bc05.77c0c","type":"change","z":"56a9ddfc.0001f4","name":"lights","rules":[{"t":"set","p":"lights","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":2080,"wires":[[]]},{"id":"bc6de8ba.6fe0a8","type":"debug","z":"56a9ddfc.0001f4","name":"Lights","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3390,"y":2120,"wires":[]},{"id":"c184b3ad.f0547","type":"function","z":"56a9ddfc.0001f4","name":"Light Name, ID, Abilities","func":"var response = [];\nvar rooms = flow.get(\"rooms\") || {};\nvar size = Object.keys(rooms).length;\nif(size <= 0) {\n    node.error(\"Please Update Rooms First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"type\": item.metadata.archetype,\n        \"id\": item.id,\n        \"color\": item.hasOwnProperty(\"color\") ? true : false,\n        \"temp\": item.hasOwnProperty(\"color_temperature\") ? true : false\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Lights\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":2120,"wires":[["ab31bc05.77c0c","bc6de8ba.6fe0a8"]]},{"id":"29f74ca9.125ba4","type":"inject","z":"56a9ddfc.0001f4","name":"Buttons (an Array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"button","payloadType":"flow","x":1950,"y":2020,"wires":[["1adff996.f43ed6"]]},{"id":"8b2e2ac7.3015b8","type":"inject","z":"56a9ddfc.0001f4","name":"Buttons (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"button","payloadType":"flow","x":1950,"y":2060,"wires":[["1adff996.f43ed6"]]},{"id":"c1c632c6.7c459","type":"inject","z":"56a9ddfc.0001f4","name":"Rooms (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"rooms_array","payloadType":"flow","x":1950,"y":1380,"wires":[["1adff996.f43ed6"]]},{"id":"5281ce31.81651","type":"function","z":"56a9ddfc.0001f4","name":"Room Name and ID","func":"var response = [];\nvar roomkeys = {};\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n        roomkeys[item.id] = item.metadata.name;\n        response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"rooms name/rid\",\n    \"keys\": roomkeys\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3100,"y":1360,"wires":[["b0c1c08f.cd09","1c2578db.96e2c7"]]},{"id":"ab0eaa70.e72fb8","type":"switch","z":"56a9ddfc.0001f4","name":"Device","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"device","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":1780,"wires":[["8b5bcae6.1e48c8"]]},{"id":"8b5bcae6.1e48c8","type":"function","z":"56a9ddfc.0001f4","name":"Devices Button and Motion","func":"// NOTE: Devices have multipe rtypes in the services\n// This script grabs the first one, so a motion sensor may show\n// up as \"temperature\" as it also does temp. don't worry\n// this script is more to get the name of the devices to help\n// with the button/motion scripts.\nvar response = [];\nvar devices = {};\nmsg.payload.data.forEach(function(item){\n    try {\n        if(item.metadata.archetype == \"unknown_archetype\") {\n            var pair = {\n                \"name\": item.metadata.name,\n                \"id\": item.id,\n                \"rid\": item.services[0].rid,\n                \"rtype\": item.services[0].rtype\n            };\n            devices[item.id] = item.metadata.name;\n            response.push(pair);\n        }\n    } catch(err) {\n        node.warn(err);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"devices name/rid\",\n    \"keys\": devices\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3080,"y":1780,"wires":[["d6d0e3ed.3456","ed685ba8.78f468"]]},{"id":"d6d0e3ed.3456","type":"change","z":"56a9ddfc.0001f4","name":"devices","rules":[{"t":"set","p":"devices","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3140,"y":1740,"wires":[[]]},{"id":"11c52499.8a819b","type":"function","z":"56a9ddfc.0001f4","name":"Zone Name and ID","func":"var response = [];\nvar roomkeys = {};\nmsg.payload.data.forEach(function(item){\n    if(item.hasOwnProperty(\"services\")) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n        roomkeys[item.id] = item.metadata.name;\n        response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"zones name/rid\",\n    \"keys\": roomkeys\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3110,"y":1160,"wires":[["4ce2bfd3.60447","5bf4d24f.d7f07c"]]},{"id":"9da74eb5.c82d4","type":"function","z":"56a9ddfc.0001f4","name":"Zone Name and ID (array)","func":"var response = [];\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n         response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"zones name/rid\",\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3090,"y":1200,"wires":[["ed3f26cb.0cf278"]]},{"id":"9d108223.484bb","type":"function","z":"56a9ddfc.0001f4","name":"Scene Name, ID, Room Name","func":"var response = [];\nvar rooms = flow.get(\"rooms\") || {};\nvar size = Object.keys(rooms).length;\nif(size <= 0) {\n    node.error(\"Please Update Rooms First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"id\": item.id,\n        // \"rid\": item.group.rid,\n        // \"rtype\": item.group.rtype,\n        \"room-name\": rooms[item.group.rid]\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Scene name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3070,"y":1640,"wires":[["745bd723.b4cb48"]]},{"id":"18ca2231.e3138e","type":"function","z":"56a9ddfc.0001f4","name":"Room Name and ID (array)","func":"var response = [];\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n         response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"rooms name/rid\",\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3080,"y":1400,"wires":[["9088582b.14ed48"]]},{"id":"9088582b.14ed48","type":"change","z":"56a9ddfc.0001f4","name":"rooms_array","rules":[{"t":"set","p":"rooms_array","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3130,"y":1440,"wires":[[]]},{"id":"ed3f26cb.0cf278","type":"change","z":"56a9ddfc.0001f4","name":"zones_array","rules":[{"t":"set","p":"zones_array","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3130,"y":1240,"wires":[[]]},{"id":"461c6f4.a8ac19","type":"inject","z":"56a9ddfc.0001f4","name":"Rooms (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"rooms_array","payloadType":"flow","x":1960,"y":1340,"wires":[["1adff996.f43ed6"]]},{"id":"3e0417af.770258","type":"debug","z":"56a9ddfc.0001f4","name":"API V2 DATA","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2310,"y":1560,"wires":[]},{"id":"9a001341.31be3","type":"inject","z":"56a9ddfc.0001f4","name":"Zones (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"zones_array","payloadType":"flow","x":1950,"y":1640,"wires":[["1adff996.f43ed6"]]},{"id":"a35b7a0f.1afe08","type":"inject","z":"56a9ddfc.0001f4","name":"Zones (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"zones_array","payloadType":"flow","x":1960,"y":1600,"wires":[["1adff996.f43ed6"]]},{"id":"ed685ba8.78f468","type":"debug","z":"56a9ddfc.0001f4","name":"Devices","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3400,"y":1780,"wires":[]},{"id":"6515ee56.e8bbb","type":"switch","z":"56a9ddfc.0001f4","name":"Motion","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"motion","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":1900,"wires":[["eb88fcc7.fe913"]]},{"id":"eb88fcc7.fe913","type":"function","z":"56a9ddfc.0001f4","name":"Motion Name, ID, Device Name","func":"var response = [];\nvar devices = flow.get(\"devices\") || {};\nvar size = Object.keys(devices).length;\nif(size <= 0) {\n    node.error(\"Please Update Devices First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"Device\": devices[item.owner.rid],\n        \"id\": item.id,\n        \"type\": item.type,\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Motion name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3070,"y":1900,"wires":[["ebecd6ca.f71978","ca64ff94.37462"]]},{"id":"ebecd6ca.f71978","type":"debug","z":"56a9ddfc.0001f4","name":"Motion","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3390,"y":1900,"wires":[]},{"id":"ca64ff94.37462","type":"change","z":"56a9ddfc.0001f4","name":"motion","rules":[{"t":"set","p":"motion","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":1860,"wires":[[]]},{"id":"5f661afe.7ce084","type":"inject","z":"56a9ddfc.0001f4","name":"Motion Senors (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"motion","payloadType":"flow","x":1930,"y":1900,"wires":[["1adff996.f43ed6"]]},{"id":"a6af15b0.378138","type":"inject","z":"56a9ddfc.0001f4","name":"Motion Sensors (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"motion","payloadType":"flow","x":1930,"y":1860,"wires":[["1adff996.f43ed6"]]},{"id":"77339fcc.c76a8","type":"switch","z":"56a9ddfc.0001f4","name":"Button","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"button","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2810,"y":2000,"wires":[["e95d779a.615128"]]},{"id":"e17c6a61.df9538","type":"inject","z":"56a9ddfc.0001f4","name":"Lights (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"lights","payloadType":"flow","x":1950,"y":1220,"wires":[["1adff996.f43ed6"]]},{"id":"c50458a6.d2c7c8","type":"inject","z":"56a9ddfc.0001f4","name":"Lights (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"lights","payloadType":"flow","x":1960,"y":1180,"wires":[["1adff996.f43ed6"]]},{"id":"e95d779a.615128","type":"function","z":"56a9ddfc.0001f4","name":"Button Name, ID, Device Name","func":"var response = [];\nvar devices = flow.get(\"devices\") || {};\nvar size = Object.keys(devices).length;\nif(size <= 0) {\n    node.error(\"Please Update Devices First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"Device\": devices[item.owner.rid],\n        \"id\": item.id,\n        \"type\": item.type,\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Motion name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3070,"y":2000,"wires":[["20712c19.2fb934","34885ffc.14396"]]},{"id":"20712c19.2fb934","type":"change","z":"56a9ddfc.0001f4","name":"button","rules":[{"t":"set","p":"button","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":1960,"wires":[[]]},{"id":"34885ffc.14396","type":"debug","z":"56a9ddfc.0001f4","name":"Button","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3390,"y":2000,"wires":[]},{"id":"c3a2bcd7.4dde4","type":"comment","z":"56a9ddfc.0001f4","name":"2 - Readme - DOUBLE CLICK","info":"After you got all Data stored, you can easily access it here again, by clicking the inject nodes.\n\nDepending on your favorite way to do it, you can get an array in response or seperate payloads for every device. \n\nTry it out!","x":2020,"y":1140,"wires":[]},{"id":"3ae04357.a572ec","type":"comment","z":"56a9ddfc.0001f4","name":"DONT CHANGE ANY OF THESE NODES","info":"","x":2860,"y":1480,"wires":[]},{"id":"6e3a4608.2e8928","type":"link in","z":"56a9ddfc.0001f4","name":"API IN","links":["c639e802.9a6c78"],"x":375,"y":220,"wires":[["aed035b1.67d568"]]},{"id":"4bc31af9bd03bbdc","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false}]